<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" href="/img/logo/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="/js/ApiRequest.js"></script>

    <title>Nhà sách trực tuyến TikiTaka- TikiTaka.com</title>
</head>

<body>
    <header class="header">
        <nav class="container navbar">
            <div class="logo-container">
                <a href="/trangchu"><img src="/img/logo/logo.png" alt="" class="logo"></a>
            </div>
            <div class="box-search">
                <input type="text" placeholder="Tìm kiếm">
                <span><i class="fa-solid fa-magnifying-glass"></i></span>
            </div>
            <div class="user-cart-container">
                <div class="cart-item">
                    <a href="/giohang" style="color: #7A7E7F">
                        <div>
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                        <div>
                            <a href="/giohang" style="color: #7A7E7F;">Giỏ hàng</a>
                        </div>
                    </a>
                </div>
                <div class="user-item">
                    <!-- <div class="account" id="accountSection" th:style="${accountSection ? 'display: none;' : ''}">
                                <div>
                                    <i class="fa-solid fa-user"></i>
                                </div>
                                <div>
                                    <span>Tài khoản</span>
                                </div>
                                <div class="account-options">
                                    <a href="/taikhoan/thongtin"><button id="btnAccountInfo" class="btn">Thông tin tài
                                            khoản</button></a>
                                    <a href="/dangxuat"><button id="btnLogout" class="btn">Đăng xuất</button></a>
                                </div>
                            </div> -->
                    <!-- <div class="admin" id="adminSection" th:style="${adminSection ? 'display: none;' : ''}">
                                <div>
                                    <i class="fa-solid fa-user"></i>
                                </div>
                                <div>
                                    <span>Quản trị</span>
                                </div>
                                <div class="admin-options">
                                    <a href="/quantri"><button id="btnAdminManage" class="btn">Quản lý</button></a>
                                    <a href="/dangxuat"><button id="btnLogoutAdmin" class="btn">Đăng xuất</button></a>
                                </div>
                            </div> -->
                    <div class="user-options" id="userOptionsSection"
                        th:style="${userOptionsSection ? 'display: none;' : ''}">
                        <div class="login-register">
                            <a href="/dangnhap" class="btn-director-login">Đăng nhập</a>
                            <a href="/dangky" class="btn-director-register">Đăng ký</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="container-info">
            <nav class="sidebar">
                <div class="slidebar-title">
                    <h2>TÀI KHOẢN</h2>
                </div>
                <div class="slidebar-content">
                    <ul>
                        <li><a href="" id="user-info-link">Thông tin tài khoản</a></li>
                        <li><a href="" id="user-order-link" class="selected">Đơn hàng của tôi</a></li>
                    </ul>
                </div>
            </nav>

            <div class="right-content" id="user-order">
                <h2>ĐƠN HÀNG CỦA TÔI</h2>

                <div class="order-list" id="orderList">
                    <div class="order-item" th:each="order : ${orderList}">

                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer style="display: flex;">
        <div class="footer-left">
            <div>
                <a href="/trangchu"><img src="/img/logo/logo.png" alt="" class="footer-logo"></a>
            </div>
            <div>
                <p>371, Nguyễn Kiệm Gò Vấp TP HCM.</p>
                <p>Công Ty Cổ Phần Phát Hành Sách TP HCM - TIKITAKA.</p>
                <p>187 Hoàng Văn Thụ, Phường 8, Phú Nhuận, TP. HCM, Việt Nam.</p>
            </div>
            <div>
                <p>
                    TIKITAKA.com nhận đặt hàng trực tuyến và giao hàng tận nơi. KHÔNG hỗ trợ đặt mua và nhận hàng trực
                    tiếp tại văn phòng cũng như tất cả Hệ Thống TIKITAKA trên toàn quốc.
                </p>
            </div>
            <div>
                <a href=""><img src="/img/logo-bo-cong-thuong-da-thong-bao1.png" alt=""
                        style="width: 150px; margin: 10px 0"></a>
            </div>
            <div class="social-group">
                <div class="social-item">
                    <a href=""><i class="fa-brands fa-facebook" style="color: #3b5998;"></i></a>
                </div>
                <div class="social-item">
                    <a href=""><i class="fa-brands fa-square-instagram" style="color: #dd2a7b"></i></a>
                </div>
                <div class="social-item">
                    <a href=""><i class="fa-brands fa-youtube" style="color: #ff0000"></i></a>
                </div>
                <div class="social-item">
                    <a href=""><i class="fa-brands fa-tumblr" style="color: #36356d"></i></a>
                </div>
                <div class="social-item">
                    <a href=""><i class="fa-brands fa-twitter" style="color: #08a0e9"></i></a>
                </div>
                <div class="social-item">
                    <a href=""><i class="fa-brands fa-pinterest" style="color: #bd081c"></i></a>
                </div>
            </div>
            <div class="download-app">
                <a>
                    <img src="/img/android1.png" alt="">
                </a>
                <a href="">
                    <img src="/img/appstore1.png" alt="">
                </a>
            </div>
        </div>
        <div class="footer-right">
            <div class="footer-info">
                <div class="footer-info-container">
                    <div class="footer-info-item">
                        <h2>DỊCH VỤ</h2>
                        <ul>
                            <li><a href="">Điều khoản sử dụng</a></li>
                            <li><a href="">Chính sách bảo mật thông tin cá nhân</a></li>
                            <li><a href="">Chính sách bảo mật thanh toán</a></li>
                            <li><a href="">Giới thiệu Fahasa</a></li>
                            <li><a href="">Hệ thống trung tâm - nhà sách</a></li>
                        </ul>
                    </div>
                    <div class="footer-info-item">
                        <h2>HỖ TRỢ</h2>
                        <ul>
                            <li><a href="">Chính sách đổi - trả - hoàn tiền</a></li>
                            <li><a href="">Chính sách bảo hành - bồi hoàn</a></li>
                            <li><a href="">Chính sách vận chuyển</a></li>
                            <li><a href="">Chính sách khách sỉ</a></li>
                            <li><a href="">Phương thức thanh toán và xuất HĐ</a></li>
                        </ul>
                    </div>
                    <div class="footer-info-item">
                        <h2>TÀI KHOẢN CỦA TÔI</h2>
                        <ul>
                            <li><a href="/dangnhap">Đăng nhập/Tạo mới tài khoản</a></li>
                            <li><a href="/taikhoan/thongtin">Thay đổi địa chỉ khách hàng</a></li>
                            <li><a href="/taikhoan/thongtin">Chi tiết tài khoản</a></li>
                            <li><a href="/taikhoan/donhang">Lịch sử mua hàng</a></li>
                        </ul>
                    </div>
                    <div class="footer-info-item">
                        <h2>LIÊN HỆ</h2>
                        <ul>
                            <li><a href=""><i class="fa-solid fa-location-dot"></i> 371 Nguyễn Kiệm, P.3, Q.Gò Vấp,
                                    TP.HCM</a></li>
                            <li><a href=""><i class="fa-solid fa-envelope"></i> cskh@nhom1.com.vn</a></li>
                            <li><a href=""><i class="fa-solid fa-phone"></i> 19003636</a></li>
                        </ul>
                    </div>
                    <div class="footer-info-item">
                        <ul>
                            <li><img src="/img/logo-momo.png" style="width: 150px; cursor: pointer;" alt=""></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="/js/formatNumber.js"></script>
    <script src="/js/convertOrderStatus.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const urlParts = window.location.pathname.split('/');
            const accountID = urlParts[2];

            document.getElementById("user-info-link").setAttribute('href', `/taikhoan/${accountID}/thongtin`);
            document.getElementById("user-order-link").setAttribute('href', `/taikhoan/${accountID}/donhang`);

            const response = await apiRequest("GET", `/order/`);
            if (response.success) {
                const orderData = response.data;
                displayOrder(orderData, accountID);
            }
        });

        function displayOrder(orderData, accountID) {
            const orderList = document.getElementById("orderList");
            orderData.forEach(order => {
                let orderItemQuantityP;

                const orderItemQuantity = order.orderItemQuantity - 1;
                if (orderItemQuantity != 0) {
                    orderItemQuantityP = `<p>Và ${orderItemQuantity} cuốn sách khác</p>`
                }

                const orderItem = document.createElement("div");
                orderItem.className = "order-item";
                orderItem.innerHTML =
                    `<div class="order-header">
                        <span class="order-id">Mã đơn hàng: ${order.orderID}</span>
                        <span class="order-state">Tình trạng: ${convertOrderStatus(order.orderStatus)}</span>
                        <div class="header-right">
                            <span class="order-date">Ngày đặt: ${order.orderTime}</span>
                        </div>
                    </div>
                    <div class="order-details">
                        <div class="product-info" style="flex-direction: row;">
                            <img src="${order.orderFirstBook.bookImage}" alt="Product Image">
                            <div class="product-description">
                                <div>
                                    <h3>${order.orderFirstBook.bookName}</h3>
                                    ${orderItemQuantityP !== undefined ? orderItemQuantityP : ''}
                                </div>
                                <p>${formatNumber(order.orderTotal + 25000)} đ</p>
                            </div>
                        </div>
                    </div>
                    <a href=/taikhoan/${accountID}/donhang/${order.orderID}><button class="view-detail">Xem chi tiết đơn hàng</button></a>`

                orderList.appendChild(orderItem);
            });
        }
    </script>
</body>

</html>